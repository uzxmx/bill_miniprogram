"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var index_1 = require("../../request/index");
Page({
    data: {
        ready: false,
        cargo: null,
        formData: {
            name: '',
            note: '',
        },
    },
    onLoad: function (options) {
        var _this = this;
        if (options.id) {
            wx.setNavigationBarTitle({ title: '修改货物' });
            wx.showLoading({ title: '加载中' });
            index_1.get("/cargoes/" + options.id).then(function (res) {
                wx.hideLoading();
                var cargo = res.data;
                var formData = cargo;
                _this.setData({ cargo: cargo, formData: formData, ready: true });
            }).catch(function () {
                wx.hideLoading();
            });
        }
        else {
            wx.setNavigationBarTitle({ title: '添加货物' });
            this.setData({ ready: true });
        }
    },
    formInputChange: function (e) {
        var _a;
        var field = e.currentTarget.dataset.field;
        this.setData((_a = {},
            _a["formData." + field] = e.detail.value,
            _a));
    },
    showError: function (error) {
        this.setData({
            error: error
        });
    },
    submit: function () {
        var _this = this;
        var formData = this.data.formData;
        if (!formData.name) {
            this.showError('请输入货物名称');
            return;
        }
        wx.showLoading({ title: '提交中' });
        var promise;
        if (this.data.cargo) {
            promise = index_1.patch("/cargoes/" + this.data.cargo.id, formData);
        }
        else {
            promise = index_1.post('/cargoes', formData);
        }
        promise.then(function (res) {
            wx.hideLoading();
            if (_this.data.cargo) {
                wx.navigateBack();
            }
            else {
                wx.redirectTo({ url: "/pages/cargo/details?id=" + res.data.id });
            }
        }).catch(function () {
            wx.hideLoading();
            wx.showToast({
                title: '请求失败，请重新尝试',
                icon: 'none'
            });
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImZvcm0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBc0Q7QUFFdEQsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osS0FBSyxFQUFFLEtBQUs7UUFDWixLQUFLLEVBQUUsSUFBSTtRQUNYLFFBQVEsRUFBRTtZQUNSLElBQUksRUFBRSxFQUFFO1lBQ1IsSUFBSSxFQUFFLEVBQUU7U0FDVDtLQUNGO0lBRUQsTUFBTSxZQUFDLE9BQU87UUFBZCxpQkFnQkM7UUFmQyxJQUFJLE9BQU8sQ0FBQyxFQUFFLEVBQUU7WUFDZCxFQUFFLENBQUMscUJBQXFCLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQTtZQUMzQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7WUFDaEMsV0FBRyxDQUFDLGNBQVksT0FBTyxDQUFDLEVBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEdBQUc7Z0JBQ3BDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtnQkFDaEIsSUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQTtnQkFDdEIsSUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFBO2dCQUN0QixLQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxPQUFBLEVBQUUsUUFBUSxVQUFBLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7WUFDaEQsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUNQLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNsQixDQUFDLENBQUMsQ0FBQTtTQUNIO2FBQU07WUFDTCxFQUFFLENBQUMscUJBQXFCLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQTtZQUMzQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7U0FDOUI7SUFDSCxDQUFDO0lBRUQsZUFBZSxFQUFmLFVBQWdCLENBQU07O1FBQ1osSUFBQSxLQUFLLEdBQUssQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLE1BQTVCLENBQTRCO1FBQ3pDLElBQUksQ0FBQyxPQUFPO1lBQ1YsR0FBQyxjQUFZLEtBQU8sSUFBRyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUs7Z0JBQ3JDLENBQUE7SUFDSixDQUFDO0lBRUQsU0FBUyxFQUFULFVBQVUsS0FBYTtRQUNyQixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsS0FBSyxPQUFBO1NBQ04sQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELE1BQU07UUFBTixpQkE2QkM7UUE1QkMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUE7UUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUU7WUFDbEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQTtZQUN6QixPQUFNO1NBQ1A7UUFFRCxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7UUFDaEMsSUFBSSxPQUFPLENBQUE7UUFDWCxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBRW5CLE9BQU8sR0FBRyxhQUFLLENBQUMsY0FBWSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7U0FDNUQ7YUFBTTtZQUNMLE9BQU8sR0FBRyxZQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFBO1NBQ3JDO1FBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFBLEdBQUc7WUFDZCxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7WUFDaEIsSUFBSSxLQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtnQkFDbkIsRUFBRSxDQUFDLFlBQVksRUFBRSxDQUFBO2FBQ2xCO2lCQUFNO2dCQUNMLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxHQUFHLEVBQUUsNkJBQTJCLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBSSxFQUFFLENBQUMsQ0FBQTthQUNqRTtRQUNILENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUNQLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNoQixFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUNYLEtBQUssRUFBRSxZQUFZO2dCQUNuQixJQUFJLEVBQUUsTUFBTTthQUNiLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldCwgcG9zdCwgcGF0Y2ggfSBmcm9tICcuLi8uLi9yZXF1ZXN0L2luZGV4J1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIHJlYWR5OiBmYWxzZSxcbiAgICBjYXJnbzogbnVsbCxcbiAgICBmb3JtRGF0YToge1xuICAgICAgbmFtZTogJycsXG4gICAgICBub3RlOiAnJyxcbiAgICB9LFxuICB9LFxuXG4gIG9uTG9hZChvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMuaWQpIHtcbiAgICAgIHd4LnNldE5hdmlnYXRpb25CYXJUaXRsZSh7IHRpdGxlOiAn5L+u5pS56LSn54mpJyB9KVxuICAgICAgd3guc2hvd0xvYWRpbmcoeyB0aXRsZTogJ+WKoOi9veS4rScgfSlcbiAgICAgIGdldChgL2NhcmdvZXMvJHtvcHRpb25zLmlkfWApLnRoZW4ocmVzID0+IHtcbiAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgICBjb25zdCBjYXJnbyA9IHJlcy5kYXRhXG4gICAgICAgIGNvbnN0IGZvcm1EYXRhID0gY2FyZ29cbiAgICAgICAgdGhpcy5zZXREYXRhKHsgY2FyZ28sIGZvcm1EYXRhLCByZWFkeTogdHJ1ZSB9KVxuICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICB3eC5zZXROYXZpZ2F0aW9uQmFyVGl0bGUoeyB0aXRsZTogJ+a3u+WKoOi0p+eJqScgfSlcbiAgICAgIHRoaXMuc2V0RGF0YSh7IHJlYWR5OiB0cnVlIH0pXG4gICAgfVxuICB9LFxuXG4gIGZvcm1JbnB1dENoYW5nZShlOiBhbnkpIHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldFxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBbYGZvcm1EYXRhLiR7ZmllbGR9YF06IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcblxuICBzaG93RXJyb3IoZXJyb3I6IHN0cmluZykge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBlcnJvclxuICAgIH0pXG4gIH0sXG5cbiAgc3VibWl0KCkge1xuICAgIGxldCBmb3JtRGF0YSA9IHRoaXMuZGF0YS5mb3JtRGF0YVxuICAgIGlmICghZm9ybURhdGEubmFtZSkge1xuICAgICAgdGhpcy5zaG93RXJyb3IoJ+ivt+i+k+WFpei0p+eJqeWQjeensCcpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5o+Q5Lqk5LitJyB9KVxuICAgIGxldCBwcm9taXNlXG4gICAgaWYgKHRoaXMuZGF0YS5jYXJnbykge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgcHJvbWlzZSA9IHBhdGNoKGAvY2FyZ29lcy8ke3RoaXMuZGF0YS5jYXJnby5pZH1gLCBmb3JtRGF0YSlcbiAgICB9IGVsc2Uge1xuICAgICAgcHJvbWlzZSA9IHBvc3QoJy9jYXJnb2VzJywgZm9ybURhdGEpXG4gICAgfVxuICAgIHByb21pc2UudGhlbihyZXMgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgaWYgKHRoaXMuZGF0YS5jYXJnbykge1xuICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd3gucmVkaXJlY3RUbyh7IHVybDogYC9wYWdlcy9jYXJnby9kZXRhaWxzP2lkPSR7cmVzLmRhdGEuaWR9YCB9KVxuICAgICAgfVxuICAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgIHRpdGxlOiAn6K+35rGC5aSx6LSl77yM6K+36YeN5paw5bCd6K+VJyxcbiAgICAgICAgaWNvbjogJ25vbmUnXG4gICAgICB9KVxuICAgIH0pXG4gIH1cbn0pXG4iXX0=