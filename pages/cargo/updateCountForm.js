"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var index_1 = require("../../request/index");
Page({
    data: {
        categoryId: '',
        action: '',
        title: '',
        totalCount: 0,
        price: 0,
        createBill: true,
        formData: {
            delta: '',
            bill: {
                billed_at: ''
            }
        },
    },
    onLoad: function (options) {
        var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var day = date.getDate();
        this.setData({
            categoryId: options.categoryId,
            action: options.action,
            title: options.action === 'incr' ? '入库' : '出库',
            totalCount: Number.parseInt(options.totalCount),
            price: Number.parseFloat(options.price),
        });
        var formData = this.data.formData;
        formData.bill.billed_at = year + "-" + month + "-" + day;
        this.setData({ formData: formData });
    },
    onCreateBillChanged: function (e) {
        this.setData({ createBill: e.detail.value });
    },
    formInputChange: function (e) {
        var _a;
        var field = e.currentTarget.dataset.field;
        if (field === 'delta') {
            var amount = e.detail.value * this.data.price;
            console.log(amount);
            var formData = this.data.formData;
            formData.bill.amount = amount;
            formData.bill.actual_amount = amount;
            this.setData({ formData: formData });
        }
        this.setData((_a = {},
            _a["formData." + field] = e.detail.value,
            _a));
    },
    showError: function (error) {
        this.setData({
            error: error
        });
    },
    submit: function () {
        var formData = this.data.formData;
        if (!formData.delta) {
            this.showError("\u8BF7\u8F93\u5165" + this.data.title + "\u6570\u91CF");
            return;
        }
        if (this.data.createBill) {
            formData.create_bill = true;
        }
        else {
            delete formData.create_bill;
        }
        formData.action_type = this.data.action;
        wx.showLoading({ title: '提交中' });
        index_1.post("/cargo_categories/" + this.data.categoryId + "/update_count", formData).then(function () {
            wx.hideLoading();
            wx.navigateBack();
        }).catch(function () {
            wx.hideLoading();
            wx.showToast({
                title: '请求失败，请重新尝试',
                icon: 'none'
            });
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBkYXRlQ291bnRGb3JtLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXBkYXRlQ291bnRGb3JtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkNBQTBDO0FBRTFDLElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLFVBQVUsRUFBRSxFQUFFO1FBQ2QsTUFBTSxFQUFFLEVBQUU7UUFDVixLQUFLLEVBQUUsRUFBRTtRQUNULFVBQVUsRUFBRSxDQUFDO1FBQ2IsS0FBSyxFQUFFLENBQUM7UUFDUixVQUFVLEVBQUUsSUFBSTtRQUNoQixRQUFRLEVBQUU7WUFDUixLQUFLLEVBQUUsRUFBRTtZQUNULElBQUksRUFBRTtnQkFDSixTQUFTLEVBQUUsRUFBRTthQUNkO1NBQ0Y7S0FDRjtJQUVELE1BQU0sRUFBTixVQUFPLE9BQU87UUFDWixJQUFNLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFBO1FBQ3ZCLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTtRQUMvQixJQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQ2pDLElBQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQTtRQUMxQixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO1lBQzlCLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtZQUN0QixLQUFLLEVBQUUsT0FBTyxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSTtZQUM5QyxVQUFVLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsVUFBVyxDQUFDO1lBQ2hELEtBQUssRUFBRSxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFNLENBQUM7U0FDekMsQ0FBQyxDQUFBO1FBRUYsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUE7UUFDakMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLEdBQU0sSUFBSSxTQUFJLEtBQUssU0FBSSxHQUFLLENBQUE7UUFDbkQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFFBQVEsVUFBQSxFQUFFLENBQUMsQ0FBQTtJQUM1QixDQUFDO0lBRUQsbUJBQW1CLEVBQW5CLFVBQW9CLENBQU07UUFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUE7SUFDOUMsQ0FBQztJQUVELGVBQWUsRUFBZixVQUFnQixDQUFNOztRQUNaLElBQUEsS0FBSyxHQUFLLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxNQUE1QixDQUE0QjtRQUN6QyxJQUFJLEtBQUssS0FBSyxPQUFPLEVBQUU7WUFDckIsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUE7WUFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUNuQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQTtZQUVqQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUE7WUFFN0IsUUFBUSxDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFBO1lBQ3BDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxRQUFRLFVBQUEsRUFBRSxDQUFDLENBQUE7U0FDM0I7UUFDRCxJQUFJLENBQUMsT0FBTztZQUNWLEdBQUMsY0FBWSxLQUFPLElBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLO2dCQUNyQyxDQUFBO0lBQ0osQ0FBQztJQUVELFNBQVMsRUFBVCxVQUFVLEtBQWE7UUFDckIsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNYLEtBQUssT0FBQTtTQUNOLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxNQUFNO1FBQ0osSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUE7UUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFNBQVMsQ0FBQyx1QkFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssaUJBQUksQ0FBQyxDQUFBO1lBQ3pDLE9BQU07U0FDUDtRQUVELElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFFeEIsUUFBUSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUE7U0FDNUI7YUFBTTtZQUVMLE9BQU8sUUFBUSxDQUFDLFdBQVcsQ0FBQTtTQUM1QjtRQUVELFFBQVEsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUE7UUFFdkMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFBO1FBQ2hDLFlBQUksQ0FBQyx1QkFBcUIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLGtCQUFlLEVBQUUsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQzVFLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNoQixFQUFFLENBQUMsWUFBWSxFQUFFLENBQUE7UUFDbkIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQ1AsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFBO1lBQ2hCLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0JBQ1gsS0FBSyxFQUFFLFlBQVk7Z0JBQ25CLElBQUksRUFBRSxNQUFNO2FBQ2IsQ0FBQyxDQUFBO1FBQ0osQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDO0NBQ0YsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcG9zdCB9IGZyb20gJy4uLy4uL3JlcXVlc3QvaW5kZXgnXG5cblBhZ2Uoe1xuICBkYXRhOiB7XG4gICAgY2F0ZWdvcnlJZDogJycsXG4gICAgYWN0aW9uOiAnJyxcbiAgICB0aXRsZTogJycsXG4gICAgdG90YWxDb3VudDogMCxcbiAgICBwcmljZTogMCxcbiAgICBjcmVhdGVCaWxsOiB0cnVlLFxuICAgIGZvcm1EYXRhOiB7XG4gICAgICBkZWx0YTogJycsXG4gICAgICBiaWxsOiB7XG4gICAgICAgIGJpbGxlZF9hdDogJydcbiAgICAgIH1cbiAgICB9LFxuICB9LFxuXG4gIG9uTG9hZChvcHRpb25zKSB7XG4gICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKClcbiAgICBjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpXG4gICAgY29uc3QgbW9udGggPSBkYXRlLmdldE1vbnRoKCkgKyAxXG4gICAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKClcbiAgICB0aGlzLnNldERhdGEoe1xuICAgICAgY2F0ZWdvcnlJZDogb3B0aW9ucy5jYXRlZ29yeUlkLFxuICAgICAgYWN0aW9uOiBvcHRpb25zLmFjdGlvbixcbiAgICAgIHRpdGxlOiBvcHRpb25zLmFjdGlvbiA9PT0gJ2luY3InID8gJ+WFpeW6kycgOiAn5Ye65bqTJyxcbiAgICAgIHRvdGFsQ291bnQ6IE51bWJlci5wYXJzZUludChvcHRpb25zLnRvdGFsQ291bnQhKSxcbiAgICAgIHByaWNlOiBOdW1iZXIucGFyc2VGbG9hdChvcHRpb25zLnByaWNlISksXG4gICAgfSlcblxuICAgIGxldCBmb3JtRGF0YSA9IHRoaXMuZGF0YS5mb3JtRGF0YVxuICAgIGZvcm1EYXRhLmJpbGwuYmlsbGVkX2F0ID0gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YFxuICAgIHRoaXMuc2V0RGF0YSh7IGZvcm1EYXRhIH0pXG4gIH0sXG5cbiAgb25DcmVhdGVCaWxsQ2hhbmdlZChlOiBhbnkpIHtcbiAgICB0aGlzLnNldERhdGEoeyBjcmVhdGVCaWxsOiBlLmRldGFpbC52YWx1ZSB9KVxuICB9LFxuXG4gIGZvcm1JbnB1dENoYW5nZShlOiBhbnkpIHtcbiAgICBjb25zdCB7IGZpZWxkIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldFxuICAgIGlmIChmaWVsZCA9PT0gJ2RlbHRhJykge1xuICAgICAgbGV0IGFtb3VudCA9IGUuZGV0YWlsLnZhbHVlICogdGhpcy5kYXRhLnByaWNlXG4gICAgICBjb25zb2xlLmxvZyhhbW91bnQpXG4gICAgICBsZXQgZm9ybURhdGEgPSB0aGlzLmRhdGEuZm9ybURhdGFcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGZvcm1EYXRhLmJpbGwuYW1vdW50ID0gYW1vdW50XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBmb3JtRGF0YS5iaWxsLmFjdHVhbF9hbW91bnQgPSBhbW91bnRcbiAgICAgIHRoaXMuc2V0RGF0YSh7IGZvcm1EYXRhIH0pXG4gICAgfVxuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBbYGZvcm1EYXRhLiR7ZmllbGR9YF06IGUuZGV0YWlsLnZhbHVlXG4gICAgfSlcbiAgfSxcblxuICBzaG93RXJyb3IoZXJyb3I6IHN0cmluZykge1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBlcnJvclxuICAgIH0pXG4gIH0sXG5cbiAgc3VibWl0KCkge1xuICAgIGxldCBmb3JtRGF0YSA9IHRoaXMuZGF0YS5mb3JtRGF0YVxuICAgIGlmICghZm9ybURhdGEuZGVsdGEpIHtcbiAgICAgIHRoaXMuc2hvd0Vycm9yKGDor7fovpPlhaUke3RoaXMuZGF0YS50aXRsZX3mlbDph49gKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YS5jcmVhdGVCaWxsKSB7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBmb3JtRGF0YS5jcmVhdGVfYmlsbCA9IHRydWVcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgZGVsZXRlIGZvcm1EYXRhLmNyZWF0ZV9iaWxsXG4gICAgfVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBmb3JtRGF0YS5hY3Rpb25fdHlwZSA9IHRoaXMuZGF0YS5hY3Rpb25cblxuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfmj5DkuqTkuK0nIH0pXG4gICAgcG9zdChgL2NhcmdvX2NhdGVnb3JpZXMvJHt0aGlzLmRhdGEuY2F0ZWdvcnlJZH0vdXBkYXRlX2NvdW50YCwgZm9ybURhdGEpLnRoZW4oKCkgPT4ge1xuICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgd3gubmF2aWdhdGVCYWNrKClcbiAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICB0aXRsZTogJ+ivt+axguWksei0pe+8jOivt+mHjeaWsOWwneivlScsXG4gICAgICAgIGljb246ICdub25lJ1xuICAgICAgfSlcbiAgICB9KVxuICB9XG59KVxuIl19