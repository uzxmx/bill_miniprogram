"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var index_1 = require("../../request/index");
var manager_1 = require("../../upload/manager");
Page({
    data: {
        id: '',
        cargo: {}
    },
    onLoad: function (options) {
        this.setData({ id: options.id });
    },
    onShow: function () {
        this.loadData();
    },
    loadData: function () {
        var _this = this;
        wx.showLoading({ title: '加载中' });
        index_1.get("/cargoes/" + this.data.id).then(function (res) {
            wx.hideLoading();
            res.data.categories.forEach(function (e) {
                if (e.photo) {
                    e.photo_url = manager_1.default.getUrl(e.photo);
                }
                else {
                    e.photo_url = '../../assets/images/icon-package.png';
                }
            });
            _this.setData({ cargo: res.data });
        }).catch(function () {
            wx.hideLoading();
        });
    },
    updateCargo: function () {
        wx.navigateTo({ url: "/pages/cargo/form?id=" + this.data.id });
    },
    deleteCargo: function () {
        var _this = this;
        wx.showModal({
            content: '是否确认删除该货物?',
            success: function (res) {
                if (res.confirm) {
                    wx.showLoading({ title: '删除中' });
                    index_1.del("/cargoes/" + _this.data.cargo.id).then(function () {
                        wx.hideLoading();
                        wx.navigateBack();
                    }).catch(function () {
                        wx.hideLoading();
                        wx.showToast({
                            title: '请求失败，请重新尝试',
                            icon: 'none'
                        });
                    });
                }
            }
        });
    },
    updateCategory: function (e) {
        var id = e.currentTarget.dataset.id;
        wx.navigateTo({ url: "/pages/cargo/categoryForm?id=" + id });
    },
    updateCount: function (e) {
        var _a = e.currentTarget.dataset, id = _a.id, action = _a.action, parentId = _a.parentId;
        if (!parentId) {
            parentId = id;
        }
        var category = this.data.cargo.categories.find(function (c) { return c.id === parentId; });
        var price = category.price;
        var count;
        if (parentId !== id) {
            count = category.children.find(function (c) { return c.id === id; }).count;
        }
        else {
            count = category.count;
        }
        wx.navigateTo({ url: "/pages/cargo/updateCountForm?categoryId=" + id + "&action=" + action + "&totalCount=" + count + "&price=" + price });
    },
    addSubCategory: function (e) {
        var id = e.currentTarget.dataset.id;
        wx.navigateTo({ url: "/pages/cargo/categoryForm?cargoId=" + this.data.id + "&parentId=" + id });
    },
    deleteCategory: function (e) {
        var _this = this;
        var id = e.currentTarget.dataset.id;
        wx.showModal({
            content: '是否确认删除该分类?',
            success: function (res) {
                if (res.confirm) {
                    wx.showLoading({ title: '删除中' });
                    index_1.del("/cargo_categories/" + id).then(function () {
                        wx.hideLoading();
                        _this.loadData();
                    }).catch(function () {
                        wx.hideLoading();
                    });
                }
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0YWlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRldGFpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw2Q0FBOEM7QUFDOUMsZ0RBQWdEO0FBRWhELElBQUksQ0FBQztJQUNILElBQUksRUFBRTtRQUNKLEVBQUUsRUFBRSxFQUFFO1FBQ04sS0FBSyxFQUFFLEVBQUU7S0FDVjtJQUVELE1BQU0sWUFBQyxPQUFPO1FBQ1osSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQTtJQUNsQyxDQUFDO0lBRUQsTUFBTTtRQUNKLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtJQUNqQixDQUFDO0lBRUQsUUFBUSxFQUFSO1FBQUEsaUJBZUM7UUFkQyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7UUFDaEMsV0FBRyxDQUFDLGNBQVksSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxHQUFHO1lBQ3RDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtZQUNoQixHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsVUFBQyxDQUFNO2dCQUNqQyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUU7b0JBQ1gsQ0FBQyxDQUFDLFNBQVMsR0FBRyxpQkFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUE7aUJBQzVDO3FCQUFNO29CQUNMLENBQUMsQ0FBQyxTQUFTLEdBQUcsc0NBQXNDLENBQUE7aUJBQ3JEO1lBQ0gsQ0FBQyxDQUFDLENBQUE7WUFDRixLQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFBO1FBQ25DLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztZQUNQLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtRQUNsQixDQUFDLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFFRCxXQUFXO1FBQ1QsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSwwQkFBd0IsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQ2hFLENBQUM7SUFFRCxXQUFXO1FBQVgsaUJBb0JDO1FBbkJDLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDWCxPQUFPLEVBQUUsWUFBWTtZQUNyQixPQUFPLEVBQUUsVUFBQSxHQUFHO2dCQUNWLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRTtvQkFDZixFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7b0JBRWhDLFdBQUcsQ0FBQyxjQUFZLEtBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUksQ0FBQyxDQUFDLElBQUksQ0FBQzt3QkFDekMsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFBO3dCQUNoQixFQUFFLENBQUMsWUFBWSxFQUFFLENBQUE7b0JBQ25CLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQzt3QkFDUCxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7d0JBQ2hCLEVBQUUsQ0FBQyxTQUFTLENBQUM7NEJBQ1gsS0FBSyxFQUFFLFlBQVk7NEJBQ25CLElBQUksRUFBRSxNQUFNO3lCQUNiLENBQUMsQ0FBQTtvQkFDSixDQUFDLENBQUMsQ0FBQTtpQkFDSDtZQUNILENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBRUQsY0FBYyxFQUFkLFVBQWUsQ0FBTTtRQUNYLElBQUEsRUFBRSxHQUFLLENBQUMsQ0FBQyxhQUFhLENBQUMsT0FBTyxHQUE1QixDQUE0QjtRQUN0QyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsR0FBRyxFQUFFLGtDQUFnQyxFQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQzlELENBQUM7SUFFRCxXQUFXLEVBQVgsVUFBWSxDQUFNO1FBQ1osSUFBQSxLQUEyQixDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBaEQsRUFBRSxRQUFBLEVBQUUsTUFBTSxZQUFBLEVBQUUsUUFBUSxjQUE0QixDQUFBO1FBQ3RELElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDYixRQUFRLEdBQUcsRUFBRSxDQUFBO1NBQ2Q7UUFFRCxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBTSxJQUFLLE9BQUEsQ0FBQyxDQUFDLEVBQUUsS0FBSyxRQUFRLEVBQWpCLENBQWlCLENBQUMsQ0FBQTtRQUM3RSxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFBO1FBQzFCLElBQUksS0FBSyxDQUFBO1FBQ1QsSUFBSSxRQUFRLEtBQUssRUFBRSxFQUFFO1lBQ25CLEtBQUssR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFDLENBQU0sSUFBSyxPQUFBLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFYLENBQVcsQ0FBQyxDQUFDLEtBQUssQ0FBQTtTQUM5RDthQUFNO1lBQ0wsS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUE7U0FDdkI7UUFDRCxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsR0FBRyxFQUFFLDZDQUEyQyxFQUFFLGdCQUFXLE1BQU0sb0JBQWUsS0FBSyxlQUFVLEtBQU8sRUFBRSxDQUFDLENBQUE7SUFDN0gsQ0FBQztJQUVELGNBQWMsRUFBZCxVQUFlLENBQU07UUFDWCxJQUFBLEVBQUUsR0FBSyxDQUFDLENBQUMsYUFBYSxDQUFDLE9BQU8sR0FBNUIsQ0FBNEI7UUFDdEMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEdBQUcsRUFBRSx1Q0FBcUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLGtCQUFhLEVBQUksRUFBRSxDQUFDLENBQUE7SUFDNUYsQ0FBQztJQUVELGNBQWMsRUFBZCxVQUFlLENBQU07UUFBckIsaUJBZ0JDO1FBZlMsSUFBQSxFQUFFLEdBQUssQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLEdBQTVCLENBQTRCO1FBQ3RDLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDWCxPQUFPLEVBQUUsWUFBWTtZQUNyQixPQUFPLEVBQUUsVUFBQSxHQUFHO2dCQUNWLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRTtvQkFDZixFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUE7b0JBQ2hDLFdBQUcsQ0FBQyx1QkFBcUIsRUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDO3dCQUNsQyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7d0JBQ2hCLEtBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtvQkFDakIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO3dCQUNQLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQTtvQkFDbEIsQ0FBQyxDQUFDLENBQUE7aUJBQ0g7WUFDSCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztDQUNGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldCwgZGVsIH0gZnJvbSAnLi4vLi4vcmVxdWVzdC9pbmRleCdcbmltcG9ydCBVcGxvYWRNYW5hZ2VyIGZyb20gJy4uLy4uL3VwbG9hZC9tYW5hZ2VyJ1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIGlkOiAnJyxcbiAgICBjYXJnbzoge31cbiAgfSxcblxuICBvbkxvYWQob3B0aW9ucykge1xuICAgIHRoaXMuc2V0RGF0YSh7IGlkOiBvcHRpb25zLmlkIH0pXG4gIH0sXG5cbiAgb25TaG93KCkge1xuICAgIHRoaXMubG9hZERhdGEoKVxuICB9LFxuXG4gIGxvYWREYXRhKCkge1xuICAgIHd4LnNob3dMb2FkaW5nKHsgdGl0bGU6ICfliqDovb3kuK0nIH0pXG4gICAgZ2V0KGAvY2FyZ29lcy8ke3RoaXMuZGF0YS5pZH1gKS50aGVuKHJlcyA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICByZXMuZGF0YS5jYXRlZ29yaWVzLmZvckVhY2goKGU6IGFueSkgPT4ge1xuICAgICAgICBpZiAoZS5waG90bykge1xuICAgICAgICAgIGUucGhvdG9fdXJsID0gVXBsb2FkTWFuYWdlci5nZXRVcmwoZS5waG90bylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlLnBob3RvX3VybCA9ICcuLi8uLi9hc3NldHMvaW1hZ2VzL2ljb24tcGFja2FnZS5wbmcnXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICB0aGlzLnNldERhdGEoeyBjYXJnbzogcmVzLmRhdGEgfSlcbiAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgfSlcbiAgfSxcblxuICB1cGRhdGVDYXJnbygpIHtcbiAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiBgL3BhZ2VzL2NhcmdvL2Zvcm0/aWQ9JHt0aGlzLmRhdGEuaWR9YCB9KVxuICB9LFxuXG4gIGRlbGV0ZUNhcmdvKCkge1xuICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICBjb250ZW50OiAn5piv5ZCm56Gu6K6k5Yig6Zmk6K+l6LSn54mpPycsXG4gICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5Yig6Zmk5LitJyB9KVxuICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICBkZWwoYC9jYXJnb2VzLyR7dGhpcy5kYXRhLmNhcmdvLmlkfWApLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxuICAgICAgICAgICAgd3gubmF2aWdhdGVCYWNrKClcbiAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7XG4gICAgICAgICAgICB3eC5oaWRlTG9hZGluZygpXG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICB0aXRsZTogJ+ivt+axguWksei0pe+8jOivt+mHjeaWsOWwneivlScsXG4gICAgICAgICAgICAgIGljb246ICdub25lJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcblxuICB1cGRhdGVDYXRlZ29yeShlOiBhbnkpIHtcbiAgICBjb25zdCB7IGlkIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldFxuICAgIHd4Lm5hdmlnYXRlVG8oeyB1cmw6IGAvcGFnZXMvY2FyZ28vY2F0ZWdvcnlGb3JtP2lkPSR7aWR9YCB9KVxuICB9LFxuXG4gIHVwZGF0ZUNvdW50KGU6IGFueSkge1xuICAgIGxldCB7IGlkLCBhY3Rpb24sIHBhcmVudElkIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldFxuICAgIGlmICghcGFyZW50SWQpIHtcbiAgICAgIHBhcmVudElkID0gaWRcbiAgICB9XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGxldCBjYXRlZ29yeSA9IHRoaXMuZGF0YS5jYXJnby5jYXRlZ29yaWVzLmZpbmQoKGM6IGFueSkgPT4gYy5pZCA9PT0gcGFyZW50SWQpXG4gICAgbGV0IHByaWNlID0gY2F0ZWdvcnkucHJpY2VcbiAgICBsZXQgY291bnRcbiAgICBpZiAocGFyZW50SWQgIT09IGlkKSB7XG4gICAgICBjb3VudCA9IGNhdGVnb3J5LmNoaWxkcmVuLmZpbmQoKGM6IGFueSkgPT4gYy5pZCA9PT0gaWQpLmNvdW50XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvdW50ID0gY2F0ZWdvcnkuY291bnRcbiAgICB9XG4gICAgd3gubmF2aWdhdGVUbyh7IHVybDogYC9wYWdlcy9jYXJnby91cGRhdGVDb3VudEZvcm0/Y2F0ZWdvcnlJZD0ke2lkfSZhY3Rpb249JHthY3Rpb259JnRvdGFsQ291bnQ9JHtjb3VudH0mcHJpY2U9JHtwcmljZX1gIH0pXG4gIH0sXG5cbiAgYWRkU3ViQ2F0ZWdvcnkoZTogYW55KSB7XG4gICAgY29uc3QgeyBpZCB9ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXRcbiAgICB3eC5uYXZpZ2F0ZVRvKHsgdXJsOiBgL3BhZ2VzL2NhcmdvL2NhdGVnb3J5Rm9ybT9jYXJnb0lkPSR7dGhpcy5kYXRhLmlkfSZwYXJlbnRJZD0ke2lkfWAgfSlcbiAgfSxcblxuICBkZWxldGVDYXRlZ29yeShlOiBhbnkpIHtcbiAgICBjb25zdCB7IGlkIH0gPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldFxuICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICBjb250ZW50OiAn5piv5ZCm56Gu6K6k5Yig6Zmk6K+l5YiG57G7PycsXG4gICAgICBzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICB3eC5zaG93TG9hZGluZyh7IHRpdGxlOiAn5Yig6Zmk5LitJyB9KVxuICAgICAgICAgIGRlbChgL2NhcmdvX2NhdGVnb3JpZXMvJHtpZH1gKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgICAgICAgIHRoaXMubG9hZERhdGEoKVxuICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgIHd4LmhpZGVMb2FkaW5nKClcbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxufSlcbiJdfQ==